(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4241:function(e,r,t){Promise.resolve().then(t.bind(t,2403))},2403:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return OrderList}});var a=t(7437),i=t(2265),n=t(4033),o=t(8411);let s={Admin:["➕","Ver Todo","Taller","Traslado","Embalaje","Env\xedo"],Manager:["Ver Todo","Taller","Traslado","Embalaje","Env\xedo"],Jeweller:["Taller","Traslado"]},d={Boreas:"https://yuxyqhdkerbpjrpbeynf.supabase.co/storage/v1/object/public/ring-images/Boreas.png",Galerno:"https://yuxyqhdkerbpjrpbeynf.supabase.co/storage/v1/object/public/ring-images/Galerno.png",Plasma:"https://yuxyqhdkerbpjrpbeynf.supabase.co/storage/v1/object/public/ring-images/Plasma.png",Ecos:"https://yuxyqhdkerbpjrpbeynf.supabase.co/storage/v1/object/public/ring-images/Ecos.png"},l={Galerno:{count:1,oro:["Amatista"],plata:["Amatista"]},Boreas:{count:2,oro:["Zafiro","Aguamarina"],plata:["Zafiro","Aguamarina"]},Plasma:{count:1,oro:["Peridoto"],plata:["Zafiro"]},Ecos:{count:0}};function OrderList(){let[e,r]=(0,i.useState)([]),[t,c]=(0,i.useState)(null),[u,p]=(0,i.useState)("Taller"),[g,x]=(0,i.useState)(""),[h,f]=(0,i.useState)(""),b=(0,n.useRouter)(),[m,v]=(0,i.useState)(null),[j,_]=(0,i.useState)(!1),[y,C]=(0,i.useState)({ring_name:"-",ring_size:"-",customer_ref:"",order_date:new Date().toISOString().split("T")[0],stage:"Taller",status:"Pendiente",ring_coating:"-",ring_stone_1:"",ring_stone_2:""}),handleLogout=async()=>{await o.O.auth.signOut(),window.location.reload()};(0,i.useEffect)(()=>{fetchOrders()},[]),(0,i.useEffect)(()=>{let fetchUserAndRole=async()=>{let{data:{user:e}}=await o.O.auth.getUser();if(!e){b.push("/login");return}let{data:r,error:t}=await o.O.from("users").select("role").eq("id",e.id).single();t?(console.error(t),b.push("/login")):f(r.role)};fetchUserAndRole()},[]);let fetchOrders=async()=>{let{data:e,error:t}=await o.O.from("orders").select("*").order("order_date",{ascending:!0});t?console.error("❌ Error en Supabase:",t.message):r(e||[])},updateOrder=async(r,t)=>{let a=e.find(e=>e.id===r);if(!a)return;v({id:r,previousStatus:a.status,previousStage:a.stage});let{error:i}=await o.O.from("orders").update(t).eq("id",r);i||fetchOrders()},undoLastAction=async()=>{if(!m)return;let{id:e,previousStatus:r,previousStage:t}=m,{error:a}=await o.O.from("orders").update({status:r,stage:t}).eq("id",e);a||(fetchOrders(),v(null))},getUrgencyClass=e=>{let r=(new Date-new Date(e))/864e5;return r>4?"date-badge red":r>2?"date-badge yellow":"date-badge green"},addOrder=async()=>{var r,t;if("-"===y.ring_name||"-"===y.ring_size||!y.customer_ref)return;let a=new Date(y.order_date),i=("0"+a.getDate()).slice(-2)+("0"+(a.getMonth()+1)).slice(-2),n=e.filter(e=>new Date(e.order_date).toDateString()===a.toDateString()).length,s=y.ring_name.slice(0,3).toUpperCase()+i+("0"+(n+1)).slice(-2),c=d[y.ring_name],u=y.ring_name,g=y.ring_coating,x=(null===(r=l[u])||void 0===r?void 0:r[null==g?void 0:g.toLowerCase()])||[],h=(null===(t=l[u])||void 0===t?void 0:t.count)||0,f=[];h>=1&&f.push(y.ring_stone_1||x[0]),h>=2&&f.push(y.ring_stone_2||x[1]);let b=f.join(" & "),m={ring_model:y.ring_name,ring_size:y.ring_size,customer_ref:y.customer_ref,order_date:y.order_date,stage:y.stage,status:y.status,ring_ref:s,image_url:c,ring_coating:g,ring_stone:b},{error:v}=await o.O.from("orders").insert([m]);v||(fetchOrders(),C({ring_name:"-",ring_size:"-",customer_ref:"",order_date:new Date().toISOString().split("T")[0],stage:"Taller",status:"Pendiente",ring_coating:"-",ring_stone_1:"",ring_stone_2:""}),p("Ver Todo")),alert("\uD83D\uDE80 Nuevo pedido a\xf1adido!")},isFaded=e=>["Aceptado","EnTransito","EnCola","TransitoFinal"].includes(e),getActionButton=e=>{if("Manager"===h)return null;let r={Pendiente:{status:"Aceptado"},Aceptado:{stage:"Traslado",status:"ListoParaTraslado"},ListoParaTraslado:{status:"EnTransito"},EnTransito:{stage:"Embalaje",status:"Recibido"},Recibido:{status:"EnCola"},EnCola:{stage:"Env\xedo",status:"ListoParaEntrega"},ListoParaEntrega:{status:"TransitoFinal"},TransitoFinal:{status:"Completado"}}[e.status];if(!r)return null;let t="Jeweller"===h&&!["Taller","Traslado"].includes(e.stage);if(t)return null;let i="Advance";switch(e.status){case"Pendiente":i="✅ Aceptar Pedido";break;case"Aceptado":i="\uD83D\uDE9A Listo para Enviar";break;case"ListoParaTraslado":i="\uD83D\uDCE6 Enviar a Madrid";break;case"EnTransito":i="\uD83D\uDCCD Recibido en Madrid";break;case"Recibido":i="\uD83D\uDCE6 Comenzar Embalaje";break;case"EnCola":i="\uD83D\uDCEE Marcar como Listo";break;case"ListoParaEntrega":i="✅ Marcar como Enviado";break;case"TransitoFinal":i="✅ Marcar como Recibido"}return(0,a.jsx)("button",{style:{marginTop:"12px",backgroundColor:"#10b981",color:"white",padding:"8px 16px",border:"none",borderRadius:"8px",cursor:"pointer"},onClick:t=>{t.stopPropagation(),updateOrder(e.id,r)},children:i})},w=e.filter(e=>{var r,t,a,i,n;if("Ver Todo"!==u&&e.stage!==u&&!("Env\xedo"===u&&"Completado"===e.status))return!1;let o=g.toLowerCase();return(null===(r=e.ring_model)||void 0===r?void 0:r.toLowerCase().includes(o))||(null===(t=e.ring_ref)||void 0===t?void 0:t.toLowerCase().includes(o))||(null===(a=e.customer_ref)||void 0===a?void 0:a.toLowerCase().includes(o))||(null===(i=e.status)||void 0===i?void 0:i.toLowerCase().includes(o))||(null===(n=e.stage)||void 0===n?void 0:n.toLowerCase().includes(o))});if(!h)return(0,a.jsx)("div",{style:{textAlign:"center",marginTop:"50px"},children:"Cargando permisos del usuario..."});let D=s[h]||[];return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px 0"},children:(0,a.jsx)("img",{src:"https://yuxyqhdkerbpjrpbeynf.supabase.co/storage/v1/object/public/ring-images//aire-logo-transparent.png",alt:"Aire Logo",style:{height:"80px",objectFit:"contain"}})}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px",padding:"0 20px",position:"relative"},children:[(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("button",{onClick:()=>_(e=>!e),style:{padding:"8px 16px",borderRadius:"8px",border:"1px solid #ccc",backgroundColor:"#fff",fontWeight:"normal",fontSize:"1rem",cursor:"pointer"},children:"☰"}),j&&(0,a.jsx)("div",{style:{position:"absolute",top:"120%",left:"0",backgroundColor:"#fff",border:"1px solid #ccc",borderRadius:"8px",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",zIndex:999},children:(0,a.jsx)("button",{onClick:handleLogout,style:{padding:"10px 20px",width:"100%",textAlign:"left",background:"none",border:"none",cursor:"pointer"},children:"Cerrar sesi\xf3n"})})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[m&&(0,a.jsx)("button",{onClick:undoLastAction,title:"Deshacer \xfaltimo cambio",style:{padding:"8px 16px",borderRadius:"8px",border:"1px solid #ccc",backgroundColor:"#fff",fontWeight:"normal",fontSize:"0.9rem",cursor:"pointer"},children:"Deshacer"}),"Ver Todo"===u&&(0,a.jsx)("input",{type:"text",placeholder:"Buscar pedido...",value:g,onChange:e=>x(e.target.value),style:{padding:"8px 12px",borderRadius:"8px",border:"1px solid #ccc",fontSize:"0.9rem",width:"240px"}})]})]}),"➕"===u&&(0,a.jsxs)("div",{style:{padding:"20px",backgroundColor:"#f9fafb",borderRadius:"12px",maxWidth:"600px",margin:"0 auto"},children:[(0,a.jsxs)("select",{value:y.ring_name,onChange:e=>C({...y,ring_name:e.target.value}),children:[(0,a.jsx)("option",{value:"-",children:"Seleccione anillo"}),Object.keys(d).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(0,a.jsxs)("select",{value:y.ring_size,onChange:e=>C({...y,ring_size:e.target.value}),children:[(0,a.jsx)("option",{value:"-",children:"Seleccione talla"}),[...Array(8)].map((e,r)=>(0,a.jsx)("option",{value:r+5,children:r+5},r+5))]}),(0,a.jsx)("input",{type:"text",placeholder:"Referencia de Shopify",value:y.customer_ref,onChange:e=>C({...y,customer_ref:e.target.value})}),(0,a.jsx)("input",{type:"date",value:y.order_date,onChange:e=>C({...y,order_date:e.target.value})}),(0,a.jsxs)("select",{value:y.ring_coating,onChange:e=>C({...y,ring_coating:e.target.value}),children:[(0,a.jsx)("option",{value:"-",children:"Seleccione acabado"}),(0,a.jsx)("option",{value:"Oro",children:"Oro"}),(0,a.jsx)("option",{value:"Plata",children:"Plata"})]}),(()=>{let e=y.ring_name,r=y.ring_coating.toLowerCase(),t=l[e];if(!t||0===t.count||"-"===r)return null;let i=t[r]||[];return(0,a.jsx)("div",{style:{marginTop:"10px"},children:[...Array(t.count)].map((e,r)=>(0,a.jsxs)("select",{value:y["ring_stone_".concat(r+1)]||i[r],onChange:e=>C({...y,["ring_stone_".concat(r+1)]:e.target.value}),children:[(0,a.jsx)("option",{value:"",children:"Seleccione piedra"}),(0,a.jsx)("option",{value:"Amatista",children:"Amatista"}),(0,a.jsx)("option",{value:"Zafiro",children:"Zafiro"}),(0,a.jsx)("option",{value:"Aguamarina",children:"Aguamarina"}),(0,a.jsx)("option",{value:"Peridoto",children:"Peridoto"}),(0,a.jsx)("option",{value:"\xd3nix",children:"\xd3nix"}),(0,a.jsx)("option",{value:"Rub\xed",children:"Rub\xed"})]},r))})})(),(0,a.jsx)("button",{onClick:addOrder,children:"➕ A\xf1adir Pedido"})]}),(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:"10px",marginBottom:"20px"},children:D.map(e=>(0,a.jsx)("button",{style:{padding:"8px 16px",borderRadius:"8px",border:u===e?"2px solid #10b981":"1px solid #ccc",backgroundColor:u===e?"#ecfdf5":"white",cursor:"pointer",fontWeight:u===e?"bold":"normal"},onClick:()=>p(e),children:e},e))}),w.map(e=>{var r;let i=isFaded(e.status),n=t===e.id;return(0,a.jsxs)("div",{className:"card",style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",padding:"16px",backgroundColor:i?"#f3f4f6":"white",opacity:i?.6:1,borderRadius:"12px",marginBottom:"16px",boxShadow:"0 2px 4px rgba(0,0,0,0.06)",cursor:"pointer"},onClick:()=>c(r=>r===e.id?null:e.id),children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px",flex:1},children:[(0,a.jsx)("img",{src:(null===(r=e.image_url)||void 0===r?void 0:r.trim())||"https://via.placeholder.com/96",alt:e.ring_model,style:{width:"96px",height:"96px",objectFit:"cover",borderRadius:"12px"}}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{fontWeight:"bold"},children:[e.ring_model," (",e.ring_coating,")"]}),(0,a.jsx)("div",{children:e.ring_stone}),(0,a.jsxs)("div",{children:["Talla: ",e.ring_size]}),n&&(0,a.jsxs)("div",{style:{marginTop:"10px"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Referencia de Shopify:"})," ",e.customer_ref||"N/A"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Referencia interna:"})," ",e.ring_ref||"N/A"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"ID del pedido:"})," ",e.id]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Fecha del pedido:"})," ",new Date(e.order_date).toLocaleString()]})]})]})]}),n&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"8px"},children:[(0,a.jsx)("div",{style:{backgroundColor:"#d1fae5",color:"#065f46",padding:"4px 12px",borderRadius:"6px",fontSize:"0.875rem"},children:e.stage}),(0,a.jsx)("div",{style:{backgroundColor:"#e0f2fe",color:"#0369a1",padding:"4px 12px",borderRadius:"6px",fontSize:"0.875rem"},children:e.status}),getActionButton(e)]}),(0,a.jsx)("div",{className:getUrgencyClass(e.order_date),style:{marginLeft:"16px",alignSelf:"center",padding:"8px 12px",borderRadius:"8px",fontSize:"0.875rem"},children:new Date(e.order_date).toLocaleDateString()})]},e.id)})]})}},8411:function(e,r,t){"use strict";t.d(r,{O:function(){return i}});var a=t(4756);let i=(0,a.eI)("https://yuxyqhdkerbpjrpbeynf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl1eHlxaGRrZXJicGpycGJleW5mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ2Njg0ODYsImV4cCI6MjA2MDI0NDQ4Nn0.zaxXVGzi5Jp_WdZt7o2Uuy0HWrm_R8TpFdMs1o8UG4U")}},function(e){e.O(0,[82,971,472,744],function(){return e(e.s=4241)}),_N_E=e.O()}]);